# Docker Compose for DealHunter - Development Infrastructure
#
# Only runs PostgreSQL and Redis. Next.js runs locally for faster development.
#
# Usage:
# - Start: docker compose up -d
# - Stop: docker compose down
# - Logs: docker compose logs -f
# - Redis CLI: docker compose exec redis redis-cli -a dealhunter
# - Postgres CLI: docker compose exec postgres psql -U dealhunter
#
# Then run locally:
# - npm run dev

services:
  postgres:
    image: pgvector/pgvector:pg16
    container_name: dealhunter-postgres
    ports:
      - '5433:5432'
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-dealhunter}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-dealhunter}
      POSTGRES_DB: ${POSTGRES_DB:-dealhunter}
    volumes:
      - pgdata:/var/lib/postgresql/data
    healthcheck:
      test:
        ['CMD-SHELL', 'pg_isready -U ${POSTGRES_USER:-dealhunter} -d ${POSTGRES_DB:-dealhunter}']
      interval: 5s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7-alpine
    container_name: dealhunter-redis
    ports:
      - '6379:6379'
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD:-dealhunter}
    healthcheck:
      test: ['CMD', 'redis-cli', '-a', '${REDIS_PASSWORD:-dealhunter}', 'ping']
      interval: 5s
      timeout: 5s
      retries: 5
    restart: unless-stopped

volumes:
  pgdata:
  redis_data:
